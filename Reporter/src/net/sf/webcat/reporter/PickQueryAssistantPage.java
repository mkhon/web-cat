package net.sf.webcat.reporter;

import net.sf.webcat.reporter.queryassistants.AbstractQueryAssistantModel;
import net.sf.webcat.reporter.queryassistants.QueryAssistantDescriptor;
import net.sf.webcat.reporter.queryassistants.QueryAssistantManager;

import com.webobjects.appserver.*;
import com.webobjects.eocontrol.EOQualifier;
import com.webobjects.foundation.NSArray;

// Generated by the WOLips Templateengine Plug-in at Dec 11, 2007 12:01:27 PM

public class PickQueryAssistantPage extends ReporterComponent
{
    public PickQueryAssistantPage(WOContext context)
    {
        super(context);
    }


    public void appendToResponse(WOResponse response, WOContext context)
    {
    	queryAssistants = QueryAssistantManager.getInstance().
    		assistantsForEntity(dataSet.wcEntityName());

    	savedQueries = ReportQuery.objectsForUserAndEntitySavedQueries(
    			wcSession().localContext(), wcSession().localUser(),
    			dataSet.wcEntityName());

    	super.appendToResponse(response, context);
    }

    
    public String linkPartOfQueryAssistantDescription()
    {
    	String desc = queryAssistant.description();
    	int pipe = desc.indexOf('|');
    	
    	if(pipe >= 0)
    		return desc.substring(0, pipe);
    	else
    		return desc;
    }
    
    public String nonLinkPartOfQueryAssistantDescription()
    {
    	String desc = queryAssistant.description();
    	int pipe = desc.indexOf('|');
    	
    	if(pipe >= 0)
    		return desc.substring(pipe + 1);
    	else
    		return desc;
    }

    public WOComponent chooseQueryAssistant()
    {
    	pageControllerInSession().selectNextQueryAssistant(queryAssistant);
    	return pageControllerInSession().nextPage();
    }
    
    public WOComponent useSavedQuery()
    {
    	pageControllerInSession().selectNextSavedQuery(savedQuery);
    	return pageControllerInSession().nextPage();
    }

    // --- Component bindings -----------------------------

    public ReportDataSet dataSet;

    public NSArray<ReportDataSet> dataSets;
    
    public ReportDataSet iterDataSet;
    
	public NSArray<QueryAssistantDescriptor> queryAssistants;
	
	public QueryAssistantDescriptor queryAssistant;
	
	public NSArray<ReportQuery> savedQueries;
	
	public ReportQuery savedQuery;
}