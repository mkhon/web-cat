<html><head><title>KeyMap.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>KeyMap.js</h1><pre class="highlighted"><code><i>/**
 * @class Ext.KeyMap
 * Handles mapping keys to actions <b>for</b> an element. One key map can be used <b>for</b> multiple actions. 
 * A KeyMap can also handle a string representation of keys.&lt;br /&gt;
 * Usage:
 &lt;pre&gt;&lt;code&gt;
 <i>// map one key by key code</i>
 <b>var</b> map = <b>new</b> Ext.KeyMap(&quot;my-element&quot;, {
     key: 13,
     fn: myHandler,
     scope: myObject
 });
 
 <i>// map multiple keys to one action by string</i>
 <b>var</b> map = <b>new</b> Ext.KeyMap(&quot;my-element&quot;, {
     key: &quot;a\r\n\t&quot;,
     fn: myHandler,
     scope: myObject
 });
 
 <i>// map multiple keys to multiple actions by strings and array of codes</i>
 <b>var</b> map = <b>new</b> Ext.KeyMap(&quot;my-element&quot;, [
    {
        key: [10,13],
        fn: <b>function</b>(){ alert(&quot;Return was pressed&quot;); }
    }, {
        key: &quot;abc&quot;,
        fn: <b>function</b>(){ alert('a, b or c was pressed'); }
    }, {
        key: &quot;\t&quot;,
        ctrl:true,
        shift:true,
        fn: <b>function</b>(){ alert('Control + shift + tab was pressed.'); }
    }
]);
 &lt;/code&gt;&lt;/pre&gt;
* &lt;b&gt;Note: A KepMap starts enabled&lt;/b&gt;
* @constructor
* @param {String/HTMLElement/Ext.Element} el The element to bind to
* @param {Object} config The config
* @param {String} eventName (optional) The event to bind to (Defaults to &quot;keydown&quot;).
 */</i>
Ext.KeyMap = <b>function</b>(el, config, eventName){
    <b>this</b>.el  = Ext.get(el);
    <b>this</b>.eventName = eventName || &quot;keydown&quot;;
    <b>this</b>.bindings = [];
    <b>if</b>(config instanceof Array){
	    <b>for</b>(var i = 0, len = config.length; i &lt; len; i++){
	        <b>this</b>.addBinding(config[i]);
	    }
    }<b>else</b>{
        <b>this</b>.addBinding(config);
    }
    <b>this</b>.keyDownDelegate = Ext.EventManager.wrap(<b>this</b>.handleKeyDown, <b>this</b>, true);
    <b>this</b>.enable();
};

Ext.KeyMap.prototype = {
    stopEvent : false,
    <i>/**
     * Add a <b>new</b> binding to <b>this</b> KeyMap
     * @param {Object} config A single KeyMap config
     */</i>
	addBinding : <b>function</b>(config){
        <b>var</b> keyCode = config.key, 
            shift = config.shift, 
            ctrl = config.ctrl, 
            alt = config.alt,
            fn = config.fn,
            scope = config.scope;
        <b>if</b>(typeof keyCode == &quot;string&quot;){
            <b>var</b> ks = [];
            <b>var</b> keyString = keyCode.toUpperCase();
            <b>for</b>(var j = 0, len = keyString.length; j &lt; len; j++){
                ks.push(keyString.charCodeAt(j));
            }
            keyCode = ks;
        }
        <b>var</b> keyArray = keyCode instanceof Array;
        <b>var</b> handler = <b>function</b>(e){
            <b>if</b>((!shift || e.shiftKey) &amp;&amp; (!ctrl || e.ctrlKey) &amp;&amp;  (!alt || e.altKey)){
                <b>var</b> k = e.getKey();
                <b>if</b>(keyArray){
                    <b>for</b>(var i = 0, len = keyCode.length; i &lt; len; i++){
                        <b>if</b>(keyCode[i] == k){
                          <b>if</b>(this.stopEvent){
                              e.stopEvent();
                          }
                          fn.call(scope || window, k, e);
                          <b>return</b>;
                        }
                    }
                }<b>else</b>{
                    <b>if</b>(k == keyCode){
                        <b>if</b>(this.stopEvent){
                           e.stopEvent();
                        }
                        fn.call(scope || window, k, e);
                    }
                }
            }
        };
        <b>this</b>.bindings.push(handler);  
	},
	
	handleKeyDown : <b>function</b>(e){
	    <b>if</b>(this.enabled){ <i>//just <b>in</b> case</i>
    	    <b>var</b> b = <b>this</b>.bindings;
    	    <b>for</b>(var i = 0, len = b.length; i &lt; len; i++){
    	        b[i].call(<b>this</b>, e);
    	    }
	    }
	},
	
	<i>/**
	 * Returns true <b>if</b> this KepMap is enabled
	 * @<b>return</b> {Boolean} 
	 */</i>
	isEnabled : <b>function</b>(){
	    <b>return</b> this.enabled;  
	},
	
	<i>/**
	 * Enable <b>this</b> KeyMap
	 */</i>
	enable: <b>function</b>(){
		<b>if</b>(!<b>this</b>.enabled){
		    <b>this</b>.el.on(<b>this</b>.eventName, <b>this</b>.keyDownDelegate);
		    <b>this</b>.enabled = true;
		}
	},

	<i>/**
	 * Disable <b>this</b> KeyMap
	 */</i>
	disable: <b>function</b>(){
		<b>if</b>(this.enabled){
		    <b>this</b>.el.removeListener(<b>this</b>.eventName, <b>this</b>.keyDownDelegate);
		    <b>this</b>.enabled = false;
		}
	}
};</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>