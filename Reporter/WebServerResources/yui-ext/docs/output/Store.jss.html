<html><head><title>Store.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>Store.js</h1><pre class="highlighted"><code>Ext.data.Store = <b>function</b>(config){
    <b>this</b>.data = <b>new</b> Ext.util.MixedCollection(false);
    <b>this</b>.data.getKey = <b>function</b>(o){
        <b>return</b> o.id;
    };
    <b>this</b>.baseParams = {};
    <b>this</b>.paramNames = {
        &quot;start&quot; : &quot;start&quot;,
        &quot;limit&quot; : &quot;limit&quot;,
        &quot;sort&quot; : &quot;sort&quot;,
        &quot;dir&quot; : &quot;dir&quot;
    };
    Ext.apply(<b>this</b>, config);
    
    <b>if</b>(this.reader &amp;&amp; !<b>this</b>.recordType){ <i>// reader passed</i>
        <b>this</b>.recordType = <b>this</b>.reader.recordType;
    }

    <b>this</b>.fields = <b>this</b>.recordType.prototype.fields;

    <b>this</b>.modified = [];
    
    <b>this</b>.events = {
        datachanged : true,
        add : true,
        remove : true,
        update : true,
        clear : true,
        beforeload : true,
        load : true,
        loadexception : true
    };

    <b>if</b>(this.proxy){
        <b>this</b>.relayEvents(<b>this</b>.proxy,  [&quot;loadexception&quot;]);
    }
    <b>this</b>.sortToggle = {};
};
Ext.extend(Ext.data.Store, Ext.util.Observable, {
    remoteSort : false,
    lastOptions : null,
    
    add : <b>function</b>(records){
        records = [].concat(records);
        <b>for</b>(var i = 0, len = records.length; i &lt; len; i++){
            records[i].join(<b>this</b>);
        }
        <b>var</b> index = <b>this</b>.data.length;
        <b>this</b>.data.addAll(records);
        <b>this</b>.fireEvent(&quot;add&quot;, <b>this</b>, records, index);
    },
    
    remove : <b>function</b>(record){
        <b>var</b> index = <b>this</b>.data.indexOf(record);
        <b>this</b>.data.removeAt(index);
        <b>this</b>.fireEvent(&quot;remove&quot;, <b>this</b>, record, index);
    },
    
    removeAll : <b>function</b>(){
        <b>this</b>.data.clear();
        <b>this</b>.fireEvent(&quot;clear&quot;, <b>this</b>);
    },
    
    insert : <b>function</b>(index, records){
        records = [].concat(records);
        <b>for</b>(var i = 0, len = records.length; i &lt; len; i++){
            <b>this</b>.data.insert(index, records[i]);
            records[i].join(<b>this</b>);
        }
        <b>this</b>.fireEvent(&quot;add&quot;, <b>this</b>, records, index);
    },
    
    indexOf : <b>function</b>(record){
        <b>return</b> this.data.indexOf(record);  
    },
    
    indexOfId : <b>function</b>(id){
        <b>return</b> this.data.indexOfKey(id);  
    },
    
    getById : <b>function</b>(id){
        <b>return</b> this.data.key(id);
    },
    
    getAt : <b>function</b>(index){
        <b>return</b> this.data.itemAt(index);
    },
    
    getRange : <b>function</b>(start, end){
        <b>return</b> this.data.getRange(start, end);
    },
    
    storeOptions : <b>function</b>(o){
        o = Ext.apply({}, o);
        <b>delete</b> o.callback;
        <b>delete</b> o.scope;
        <b>this</b>.lastOptions = o; 
    },

    load : <b>function</b>(options){
        options = options || {};
        <b>if</b>(this.fireEvent(&quot;beforeload&quot;, <b>this</b>, options) !== false){
            <b>this</b>.storeOptions(options);
            <b>var</b> p = Ext.apply(options.params || {}, <b>this</b>.baseParams);
            <b>if</b>(this.sortInfo &amp;&amp; <b>this</b>.remoteSort){
                <b>var</b> pn = <b>this</b>.paramNames;
                p[pn[&quot;sort&quot;]] = <b>this</b>.sortInfo.field;
                p[pn[&quot;dir&quot;]] = <b>this</b>.sortInfo.direction;
            }
            <b>this</b>.proxy.load(p, <b>this</b>.reader, <b>this</b>.loadRecords, <b>this</b>, options);
        }
    },

    reload : <b>function</b>(options){
        <b>this</b>.load(Ext.applyIf(options||{}, <b>this</b>.lastOptions));
    },

    loadRecords : <b>function</b>(o, options, success){
        <b>if</b>(!o || !success){
            <b>if</b>(success){
                <b>this</b>.fireEvent(&quot;load&quot;, <b>this</b>, [], options);
            }
            <b>if</b>(options.callback){
                options.callback.call(options.scope || <b>this</b>, [], options, false);
            }
            <b>return</b>;
        }
        <b>var</b> r = o.records, t = o.totalRecords || r.length;
        <b>for</b>(var i = 0, len = r.length; i &lt; len; i++){
            r[i].join(<b>this</b>);
        }
        <b>if</b>(options.add !== true){
            <b>this</b>.data.clear();
            <b>this</b>.data.addAll(r);
            <b>this</b>.totalLength = t;
            <b>this</b>.applySort();
            <b>this</b>.fireEvent(&quot;datachanged&quot;, <b>this</b>);
        }<b>else</b>{
            <b>this</b>.totalLength = Math.max(t, <b>this</b>.data.length+r.length);
            <b>this</b>.data.addAll(r);
        }
        <b>this</b>.fireEvent(&quot;load&quot;, <b>this</b>, r, options);
        <b>if</b>(options.callback){
            options.callback.call(options.scope || <b>this</b>, r, options, true);
        }
    },

    loadData : <b>function</b>(o, append){
        <b>var</b> r = <b>this</b>.reader.readRecords(o);
        <b>this</b>.loadRecords(r, {add: append}, true);
    },

    getCount : <b>function</b>(){
        <b>return</b> this.data.length || 0;
    },
    
    getTotalCount : <b>function</b>(){
        <b>return</b> this.totalLength || 0;
    },
    
    getSortState : <b>function</b>(){
        <b>return</b> this.sortInfo;  
    },
    
    applySort : <b>function</b>(){
        <b>if</b>(this.sortInfo &amp;&amp; !<b>this</b>.remoteSort){
            <b>var</b> s = <b>this</b>.sortInfo, f = s.field;
            <b>var</b> st = <b>this</b>.fields.get(f).sortType;
            <b>var</b> fn = <b>function</b>(r1, r2){
                <b>var</b> v1 = st(r1.data[f]), v2 = st(r2.data[f]);
                <b>return</b> v1 &gt; v2 ? 1 : (v1 &lt; v2 ? -1 : 0);
            };
            <b>this</b>.data.sort(s.direction, fn);
            <b>if</b>(this.snapshot &amp;&amp; <b>this</b>.snapshot != <b>this</b>.data){
                <b>this</b>.snapshot.sort(s.direction, fn);
            }
        }
    },

    setDefaultSort : <b>function</b>(field, dir){
        <b>this</b>.sortInfo = {field: field, direction: dir ? dir.toUpperCase() : &quot;ASC&quot;};
    },

    sort : <b>function</b>(fieldName, dir){
        <b>var</b> f = <b>this</b>.fields.get(fieldName); 
        <b>if</b>(!dir){
            <b>if</b>(this.sortInfo &amp;&amp; <b>this</b>.sortInfo.field == f.name){ <i>// toggle sort dir</i>
                dir = (<b>this</b>.sortToggle[f.name] || &quot;ASC&quot;).toggle(&quot;ASC&quot;, &quot;DESC&quot;);
            }<b>else</b>{
                dir = f.sortDir;
            }
        }  
        <b>this</b>.sortToggle[f.name] = dir;
        <b>this</b>.sortInfo = {field: f.name, direction: dir};
        <b>if</b>(!<b>this</b>.remoteSort){
            <b>this</b>.applySort();
            <b>this</b>.fireEvent(&quot;datachanged&quot;, <b>this</b>);
        }<b>else</b>{
            <b>this</b>.load(<b>this</b>.lastOptions);
        }
    },
    
    each : <b>function</b>(fn, scope){
        <b>this</b>.data.each(fn, scope);  
    },
    
    getModifiedRecords : <b>function</b>(){
        <b>return</b> this.modified;
    },
    
    <i>/**
     * Filter the records by a specific property. 
     * @param {String} field A field on your records
     * @param {String/RegExp} value Either a string that the field 
     * should start <b>with</b> or a RegExp to test against the field
     */</i>
    filter : <b>function</b>(property, value){
        <b>if</b>(!value.exec){ <i>// not a regex</i>
            value = String(value);
            <b>if</b>(value.length == 0){
                <b>return</b> this.clearFilter();
            }
            value = <b>new</b> RegExp(&quot;^&quot; + Ext.escapeRe(value), &quot;i&quot;);
        }
        <b>this</b>.filterBy(<b>function</b>(r){
            <b>return</b> value.test(r.data[property]);
        });
	},
    
    <i>/**
     * Filter by a <b>function</b>. The passed <b>function</b> will be called <b>with</b> each 
     * record <b>in</b> this datesource. If the <b>function</b> returns true, the record is included 
     * otherwise it is filtered.
     * @param {Function} fn The <b>function</b> to be called, it will receive 2 args (record, id)
     * @param {Object} scope (optional) The scope of the <b>function</b> (defaults to <b>this</b>) 
     */</i>
    filterBy : <b>function</b>(fn, scope){
        <b>var</b> data = <b>this</b>.snapshot || <b>this</b>.data;
        <b>this</b>.snapshot = data;
        <b>this</b>.data = data.filterBy(fn, scope);
        <b>this</b>.fireEvent(&quot;datachanged&quot;, <b>this</b>);
    },
    
    clearFilter : <b>function</b>(){
        <b>if</b>(this.snapshot &amp;&amp; <b>this</b>.snapshot != <b>this</b>.data){
            <b>this</b>.data = <b>this</b>.snapshot;
            <b>delete</b> this.snapshot;
            <b>this</b>.fireEvent(&quot;datachanged&quot;, <b>this</b>);
        }
    },

    afterEdit : <b>function</b>(record){
        <b>if</b>(this.modified.indexOf(record) == -1){
            <b>this</b>.modified.push(record);
        }
        <b>this</b>.fireEvent(&quot;update&quot;, <b>this</b>, record, Ext.data.Record.EDIT);
    },

    afterReject : <b>function</b>(record){
        <b>this</b>.modified.remove(record);
        <b>this</b>.fireEvent(&quot;update&quot;, <b>this</b>, record, Ext.data.Record.REJECT);
    },

    afterCommit : <b>function</b>(record){
        <b>this</b>.modified.remove(record);
        <b>this</b>.fireEvent(&quot;update&quot;, <b>this</b>, record, Ext.data.Record.COMMIT);
    },

    commitChanges : <b>function</b>(){
        <b>var</b> m = <b>this</b>.modified.slice(0);
        <b>this</b>.modified = [];
        <b>for</b>(var i = 0, len = m.length; i &lt; len; i++){
            m[i].commit();
        }
    },

    rejectChanges : <b>function</b>(){
        <b>var</b> m = <b>this</b>.modified.slice(0);
        <b>this</b>.modified = [];
        <b>for</b>(var i = 0, len = m.length; i &lt; len; i++){
            m[i].reject();
        }
    }
});</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>