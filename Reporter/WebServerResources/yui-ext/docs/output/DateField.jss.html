<html><head><title>DateField.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>DateField.js</h1><pre class="highlighted"><code><i>/**
 * @class Ext.form.DateField
 * @extends Ext.form.TextField
Provides a date editor field, and optionally a DatePicker. The DateEditor provides a method to override (showCalendar) <b>if</b> you don't want to use the built <b>in</b> DatePicker control. The reason I chose to use my own DatePicker control rather than the nice YUI Calendar component is my control was very easy to override events to make it work well <b>with</b> the grid. its also only 5k compressed, <b>while</b> the YUI Calendar is 40k compressed. The DatePicker supports left/right keys to move months, up/down keys to move years and the mouse wheel to quickly go through the months. The DateEditor supports the following configuration options:
&lt;ul class=&quot;list&quot;&gt;
&lt;li&gt;&lt;i&gt;format&lt;/i&gt; - The date format <b>for</b> the editor. The format is identical to &lt;a href=&quot;http:<i>//www.php.net/date&quot;&gt;PHP date()&lt;/a&gt; and text is allowed. Credit <b>for</b> that goes to &lt;a style=&quot;font-weight:normal;&quot; href=&quot;http://www.xaprb.com/blog/2006/05/14/javascript-date-formatting-benchmarks/&quot;&gt;<b>this</b> fantastic date library&lt;/a&gt;. This format is <b>for</b> the editor only and doesn't affect the rendering of the cell when not <b>in</b> edit mode. Your rendering <b>function</b> can use any date format it wants.&lt;/li&gt;</i>
&lt;li&gt;&lt;i&gt;minValue&lt;/i&gt; - The minimum allowed date. Can be either a Javascript date object or a string date <b>in</b> the specified format.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;maxValue&lt;/i&gt; - The maximum allowed date. Can be either a Javascript date object or a string date <b>in</b> the specified format.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;minText&lt;/i&gt; - The tooltip to display when the date <b>in</b> the cell is before minValue.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;maxText&lt;/i&gt; - The tooltip to display when the date <b>in</b> the cell is after maxValue.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;invalidText&lt;/i&gt; - The text to display when the date <b>in</b> the field is invalid (<b>for</b> example: 02/31/06)&lt;/li&gt;
&lt;li&gt;&lt;i&gt;disabledDays&lt;/i&gt; - An array of days to disable, 0 based. For example, [0, 6] disables Sunday and Saturday.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;disabledDaysText&lt;/i&gt; - The tooltip to display when the date <b>in</b> the cell (or DatePicker) falls on a disabled day.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;disabledDates&lt;/i&gt; - An array of &quot;dates&quot; to disable, as strings. These strings will be used to build a dynamic regular expression so they are very powerful. For example, [&quot;03/08/2003&quot;, &quot;09/16/2003&quot;] would disable those dates, but [&quot;03/08&quot;, &quot;09/16&quot;] would disable them <b>for</b> every year. If you are using short years, you will want to use ^ to tell the regular expression to only match the beginning like [&quot;^03/08&quot;]. To disable March of 2006: [&quot;03/../2006&quot;] or every March [&quot;^03&quot;]. In order to support regular expressions, <b>if</b> you are using a date format that has &quot;.&quot; <b>in</b> it, you will have to  escape the dot when restricting dates. For example: [&quot;03\\.08\\.03&quot;].&lt;/li&gt;
&lt;li&gt;&lt;i&gt;disabledDatesText&lt;/i&gt; - The tooltip to display when the date <b>in</b> the cell (or DatePicker) falls on a disabled date.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;allowBlank&lt;/i&gt; - True <b>if</b> the cell is allowed to be empty.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;blankText&lt;/i&gt; - The tooltip (error message) to display when the cell is empty and is not allowed to be.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;validator&lt;/i&gt; - Any custom validation <b>function</b> you want called. The <b>function</b> must <b>return</b> true <b>if</b> the data is valid or an error message otherwise.&lt;/li&gt;
&lt;li&gt;&lt;i&gt;validationDelay&lt;/i&gt; - The delay <b>in</b> milliseconds <b>for</b> validation. Each time the user types something the field is validated after a specified delay, setting <b>this</b> value allows you to customize that delay (<b>for</b> example, <b>if</b> your custom validation routine is slow).&lt;/li&gt;
&lt;/ul&gt;
For more information on using <b>this</b> editor, see &lt;a href=&quot;http:<i>//www.jackslocum.com/yui/2006/09/10/adding-built-<b>in</b>-editing-support-to-the-yahoo-ui-extensions-grid/&quot;&gt;<b>this</b> blog post&lt;/a&gt;.</i>
* @constructor
* Create a <b>new</b> DateField
* @param {Object} config
 */</i>
Ext.form.DateField = <b>function</b>(config){
    Ext.form.DateField.superclass.constructor.call(<b>this</b>, config);
    <b>if</b>(typeof <b>this</b>.minValue == &quot;string&quot;) <b>this</b>.minValue = <b>this</b>.parseDate(<b>this</b>.minValue);
    <b>if</b>(typeof <b>this</b>.maxValue == &quot;string&quot;) <b>this</b>.maxValue = <b>this</b>.parseDate(<b>this</b>.maxValue);
    <b>this</b>.ddMatch = null;
    <b>if</b>(this.disabledDates){
        <b>var</b> dd = <b>this</b>.disabledDates;
        <b>var</b> re = &quot;(?:&quot;;
        <b>for</b>(var i = 0; i &lt; dd.length; i++){
            re += dd[i];
            <b>if</b>(i != dd.length-1) re += &quot;|&quot;;
        }
        <b>this</b>.ddMatch = <b>new</b> RegExp(re + &quot;)&quot;);
    }
};

Ext.extend(Ext.form.DateField, Ext.form.TriggerField,  {
    triggerClass : 'x-form-date-trigger',
    defaultAutoCreate : {tag: &quot;input&quot;, type: &quot;text&quot;, size: &quot;10&quot;, autocomplete: &quot;off&quot;},

    validateValue : <b>function</b>(value){
        value = <b>this</b>.formatDate(value);
        <b>if</b>(!Ext.form.DateField.superclass.validateValue.call(<b>this</b>, value)){
            <b>return</b> false;
        }
        <b>if</b>(value.length &lt; 1){ <i>// <b>if</b> it&quot;s blank and textfield didn&quot;t flag it then it's valid</i>
             <b>return</b> true;
        }
        <b>var</b> svalue = value;
        value = <b>this</b>.parseDate(value);
        <b>if</b>(!value){
            <b>this</b>.markInvalid(String.format(<b>this</b>.invalidText, svalue, <b>this</b>.format));
            <b>return</b> false;
        }
        <b>var</b> time = value.getTime();
        <b>if</b>(this.minValue &amp;&amp; time &lt; <b>this</b>.minValue.getTime()){
            <b>this</b>.markInvalid(String.format(<b>this</b>.minText, <b>this</b>.formatDate(<b>this</b>.minValue)));
            <b>return</b> false;
        }
        <b>if</b>(this.maxValue &amp;&amp; time &gt; <b>this</b>.maxValue.getTime()){
            <b>this</b>.markInvalid(String.format(<b>this</b>.maxText, <b>this</b>.formatDate(<b>this</b>.maxValue)));
            <b>return</b> false;
        }
        <b>if</b>(this.disabledDays){
            <b>var</b> day = value.getDay();
            <b>for</b>(var i = 0; i &lt; <b>this</b>.disabledDays.length; i++) {
            	<b>if</b>(day === <b>this</b>.disabledDays[i]){
            	    <b>this</b>.markInvalid(<b>this</b>.disabledDaysText);
                    <b>return</b> false;
            	}
            }
        }
        <b>var</b> fvalue = <b>this</b>.formatDate(value);
        <b>if</b>(this.ddMatch &amp;&amp; <b>this</b>.ddMatch.test(fvalue)){
            <b>this</b>.markInvalid(String.format(<b>this</b>.disabledDatesText, fvalue));
            <b>return</b> false;
        }
        <b>return</b> true;
    },

    validateBlur : <b>function</b>(){
        <b>return</b> !<b>this</b>.menu || !<b>this</b>.menu.isVisible();
    },

    getValue : <b>function</b>(){
        <b>return</b> this.parseDate(Ext.form.DateField.superclass.getValue.call(<b>this</b>)) || &quot;&quot;;
    },

    setValue : <b>function</b>(date){
        Ext.form.DateField.superclass.setValue.call(<b>this</b>, <b>this</b>.formatDate(<b>this</b>.parseDate(date)));
    },

    parseDate : <b>function</b>(value){
        <b>return</b> (!value || value instanceof Date) ?
               value : Date.parseDate(value, <b>this</b>.format);
    },

    formatDate : <b>function</b>(date){
        <b>return</b> (!date || !(date instanceof Date)) ?
               date : date.dateFormat(<b>this</b>.format);
    },

    menuListeners : {
        select: <b>function</b>(m, d){
            <b>this</b>.setValue(d);
        },
        show : <b>function</b>(){ <i>// retain focus styling</i>
            <b>this</b>.el.addClass(<b>this</b>.focusClass);
        },
        hide : <b>function</b>(){
            <b>this</b>.focus();
            <b>var</b> ml = <b>this</b>.menuListeners;
            <b>this</b>.menu.un(&quot;select&quot;, ml.select,  <b>this</b>);
            <b>this</b>.menu.un(&quot;show&quot;, ml.show,  <b>this</b>);
            <b>this</b>.menu.un(&quot;hide&quot;, ml.hide,  <b>this</b>);
        }
    },

    onTriggerClick : <b>function</b>(){
        <b>if</b>(this.disabled){
            <b>return</b>;
        }
        <b>if</b>(this.menu == null){
            <b>this</b>.menu = <b>new</b> Ext.menu.DateMenu();
        }
        Ext.apply(<b>this</b>.menu,  {
            minDate : <b>this</b>.minValue,
            maxDate : <b>this</b>.maxValue,
            disabledDatesRE : <b>this</b>.ddMatch,
            disabledDatesText : <b>this</b>.disabledDatesText,
            disabledDays : <b>this</b>.disabledDays,
            disabledDaysText : <b>this</b>.disabledDaysText,
            format : <b>this</b>.format,
            minText : String.format(<b>this</b>.minText, <b>this</b>.formatDate(<b>this</b>.minValue)),
            maxText : String.format(<b>this</b>.maxText, <b>this</b>.formatDate(<b>this</b>.maxValue))
        });
        <b>this</b>.menu.on(Ext.apply({}, <b>this</b>.menuListeners, {
            scope:<b>this</b>
        }));
        <b>this</b>.menu.picker.setValue(<b>this</b>.getValue() || <b>new</b> Date());
        <b>this</b>.menu.show(<b>this</b>.el, &quot;tl-bl?&quot;);
    },

    format : &quot;m/d/y&quot;,
    disabledDays : null,
    disabledDaysText : &quot;Disabled&quot;,
    disabledDates : null,
    disabledDatesText : &quot;Disabled&quot;,
    minValue : null,
    maxValue : null,
    minText : &quot;The date <b>in</b> this field must be after {0}&quot;,
    maxText : &quot;The date <b>in</b> this field must be before {0}&quot;,
    invalidText : &quot;{0} is not a valid date - it must be <b>in</b> the format {1}&quot;
});</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>