<html><head><title>MenuMgr.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>MenuMgr.js</h1><pre class="highlighted"><code>Ext.menu.MenuMgr = <b>function</b>(){
   <b>var</b> menus, active, groups = {};

   <i>// private - called when first menu is created</i>
   <b>function</b> init(){
       menus = {}, active = <b>new</b> Ext.util.MixedCollection();
       Ext.get(document).addKeyListener(27, <b>function</b>(){
           <b>if</b>(active.length &gt; 0){
               hideAll();
           }
       });
   }

   <b>function</b> hideAll(){
       <b>if</b>(active.length &gt; 0){
           <b>var</b> c = active.clone();
           c.each(<b>function</b>(m){
               m.hide();
           });
       }
   }

   <b>function</b> onHide(m){
       active.remove(m);
       <b>if</b>(active.length &lt; 1){
           Ext.get(document).un(&quot;mousedown&quot;, onMouseDown);
       }
   }

   <b>function</b> onShow(m){
       <b>var</b> last = active.last();
       active.add(m);
       <b>if</b>(active.length == 1){
           Ext.get(document).on(&quot;mousedown&quot;, onMouseDown);
       }
       <b>if</b>(m.parentMenu){
          m.getEl().setZIndex(parseInt(m.parentMenu.getEl().getStyle(&quot;z-index&quot;), 10) + 3);
          m.parentMenu.activeChild = m;
       }<b>else</b> if(last &amp;&amp; last.isVisible()){
          m.getEl().setZIndex(parseInt(last.getEl().getStyle(&quot;z-index&quot;), 10) + 3);
       }
   }

   <b>function</b> onBeforeHide(m){
       <b>if</b>(m.activeChild){
           m.activeChild.hide();
       }
       <b>if</b>(m.autoHideTimer){
           clearTimeout(m.autoHideTimer);
           <b>delete</b> m.autoHideTimer;
       }
   }

   <b>function</b> onBeforeShow(m){
       <b>var</b> pm = m.parentMenu;
       <b>if</b>(!pm &amp;&amp; !m.allowOtherMenus){
           hideAll();
       }<b>else</b> if(pm &amp;&amp; pm.activeChild){
           pm.activeChild.hide();
       }
   }

   <b>function</b> onMouseDown(e){
       <b>if</b>(active.length &gt; 0 &amp;&amp; !e.getTarget(&quot;.x-menu&quot;)){
           hideAll();
       }
   }

   <b>function</b> onBeforeCheck(mi, state){
       <b>if</b>(state){
           <b>var</b> g = groups[mi.group];
           <b>for</b>(var i = 0, l = g.length; i &lt; l; i++){
               <b>if</b>(g[i] != mi){
                   g[i].setChecked(false);
               }
           }
       }
   }

   <b>return</b> {
       register : <b>function</b>(menu){
           <b>if</b>(!menus){
               init();
           }
           menus[menu.id] = menu;
           menu.on(&quot;beforehide&quot;, onBeforeHide);
           menu.on(&quot;hide&quot;, onHide);
           menu.on(&quot;beforeshow&quot;, onBeforeShow);
           menu.on(&quot;show&quot;, onShow);
           <b>var</b> g = menu.group;
           <b>if</b>(g &amp;&amp; menu.events[&quot;checkchange&quot;]){
               <b>if</b>(!groups[g]){
                   groups[g] = [];
               }
               groups[g].push(menu);
               menu.on(&quot;checkchange&quot;, onCheck);
           }
       },

       get : <b>function</b>(menu){
           <b>if</b>(typeof menu == &quot;string&quot;){ <i>// menu id</i>
               <b>return</b> menus[menu];
           }<b>else</b> if(menu.events){  <i>// menu instance</i>
               <b>return</b> menu;
           }<b>else</b>{ <i>// otherwise, must be a config</i>
               <b>return</b> new Ext.menu.Menu(menu);
           }
       },

       unregister : <b>function</b>(menu){
           <b>delete</b> menus[menu.id];
           menu.un(&quot;beforehide&quot;, onBeforeHide);
           menu.un(&quot;hide&quot;, onHide);
           menu.un(&quot;beforeshow&quot;, onBeforeShow);
           menu.un(&quot;show&quot;, onShow);
           <b>var</b> g = menu.group;
           <b>if</b>(g &amp;&amp; menu.events[&quot;checkchange&quot;]){
               groups[g].remove(menu);
               menu.un(&quot;checkchange&quot;, onCheck);
           }
       },

       registerCheckable : <b>function</b>(menuItem){
           <b>var</b> g = menuItem.group;
           <b>if</b>(g){
               <b>if</b>(!groups[g]){
                   groups[g] = [];
               }
               groups[g].push(menuItem);
               menuItem.on(&quot;beforecheckchange&quot;, onBeforeCheck);
           }
       },

       unregisterCheckable : <b>function</b>(menuItem){
           <b>var</b> g = menuItem.group;
           <b>if</b>(g){
               groups[g].remove(menuItem);
               menuItem.un(&quot;beforecheckchange&quot;, onBeforeCheck);
           }
       }
   };
}();
</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>