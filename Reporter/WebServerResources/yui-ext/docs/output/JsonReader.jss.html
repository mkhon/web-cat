<html><head><title>JsonReader.js</title><link rel="stylesheet" type="text/css" href="../resources/style.css" media="screen"/></head><body><h1>JsonReader.js</h1><pre class="highlighted"><code>Ext.data.JsonReader = <b>function</b>(meta, recordType){
    Ext.data.JsonReader.superclass.constructor.call(<b>this</b>, meta, recordType);
};
Ext.extend(Ext.data.JsonReader, Ext.data.DataReader, {
    read : <b>function</b>(response){
        <b>var</b> json = response.responseText;
        <b>var</b> o = eval(&quot;(&quot;+json+&quot;)&quot;);
        <b>if</b>(!o) {
            throw {message: &quot;JsonReader.read: Json object not found&quot;};
        }
        <b>return</b> this.readRecords(o);
    },
    
    readRecords : <b>function</b>(o){
        <b>this</b>.jsonData = o;
        <b>var</b> s = <b>this</b>.meta;
    	<b>var</b> sid = s.id;
    	<b>var</b> recordType = <b>this</b>.recordType, fields = recordType.prototype.fields;
    	
    	<b>var</b> totalRecords = 0;
    	<b>if</b>(s.totalProperty){
            <b>var</b> v = parseInt(eval(&quot;o.&quot; + s.totalProperty), 10);
            <b>if</b>(!isNaN(v)){
                totalRecords = v;
            }
        }
        <b>var</b> records = [];
    	<b>var</b> root = s.root ? eval(&quot;o.&quot; + s.root) : o;
	    <b>for</b>(var i = 0; i &lt; root.length; i++){
		    <b>var</b> n = root[i];
	        <b>var</b> values = {};
	        <b>var</b> id = (n[sid] !== undefined &amp;&amp; n[sid] !== &quot;&quot; ? n[sid] : null);
	        <b>for</b>(var j = 0, jlen = fields.length; j &lt; jlen; j++){
	            <b>var</b> f = fields.items[j];
	            <b>var</b> map = f.mapping || f.name;
	            <b>var</b> v = n[map] !== undefined ? n[map] : f.defaultValue;
	            v = f.convert(v);
	            values[f.name] = v;
	        }
	        <b>var</b> record = <b>new</b> recordType(values, id);
	        record.json = n;
	        records[records.length] = record;
	    }
	    <b>return</b> {
	        records : records,
	        totalRecords : totalRecords || records.length
	    };
    }
});</code></pre><hr><div style="font-size:10px;text-align:center;color:gray;">yui-ext - Copyright &copy; 2006 Jack Slocum.  |
    Yahoo! UI - Copyright &copy; 2006 Yahoo! Inc.<br />All rights reserved.</div>
    </body></html>