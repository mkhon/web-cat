/*
 * Ext - JS Library 1.0 Alpha 3 - Rev 4
 * Copyright(c) 2006-2007, Jack Slocum.
 * 
 * http://www.extjs.com/license.txt
 */

Ext.View=function(_1,_2,_3){this.el=Ext.get(_1,true);if(typeof _2=="string"){_2=new Ext.Template(_2);}_2.compile();this.tpl=_2;Ext.apply(this,_3);this.events={"beforeclick":true,"click":true,"dblclick":true,"contextmenu":true,"selectionchange":true,"beforeselect":true};this.el.on({"click":this.onClick,"dblclick":this.onDblClick,"contextmenu":this.onContextMenu,scope:this});this.selections=[];this.nodes=[];this.cmp=new Ext.CompositeElementLite([]);if(this.store){this.setStore(this.store,true);}};Ext.extend(Ext.View,Ext.util.Observable,{selectedClass:"x-view-selected",emptyText:"",getEl:function(){return this.el;},refresh:function(){var t=this.tpl;this.clearSelections();this.el.update("");var _5=[];var _6=this.store.getRange();if(_6.length<1){this.el.update(this.emptyText);return;}for(var i=0,_8=_6.length;i<_8;i++){var _9=this.prepareData(_6[i].data,i,_6[i]);_5[_5.length]=t.apply(_9);}this.el.update(_5.join(""));this.nodes=this.el.dom.childNodes;this.updateIndexes(0);},prepareData:function(_a,_b){return _a;},onUpdate:function(ds,_d){this.clearSelections();var _e=this.store.indexOf(_d);var n=this.nodes[_e];this.tpl.insertBefore(n,this.prepareData(_d.data));n.parentNode.removeChild(n);this.updateIndexes(_e,_e);},onAdd:function(ds,_11,_12){this.clearSelections();if(this.nodes.length==0){this.refresh();return;}var n=this.nodes[_12];for(var i=0,len=_11.length;i<len;i++){var d=this.prepareData(_11[i].data);if(n){this.tpl.insertBefore(n,d);}else{this.tpl.append(this.el,d);}}this.updateIndexes(_12);},onRemove:function(ds,_18,_19){this.clearSelections();this.el.dom.removeChild(this.nodes[_19]);this.updateIndexes(_19);},refreshNode:function(_1a){this.onUpdate(this.store,this.store.getAt(_1a));},updateIndexes:function(_1b,_1c){var ns=this.nodes;_1b=_1b||0;_1c=_1c||ns.length-1;for(var i=_1b;i<=_1c;i++){ns[i].nodeIndex=i;}},setStore:function(_1f,_20){if(!_20&&this.store){this.store.un("datachanged",this.refresh);this.store.un("add",this.onAdd);this.store.un("remove",this.onRemove);this.store.un("update",this.onUpdate);this.store.un("clear",this.refresh);}if(_1f){_1f.on("datachanged",this.refresh,this);_1f.on("add",this.onAdd,this);_1f.on("remove",this.onRemove,this);_1f.on("update",this.onUpdate,this);_1f.on("clear",this.refresh,this);}this.store=_1f;this.refresh();},findItemFromChild:function(_21){var el=this.el.dom;if(!_21||_21.parentNode==el){return _21;}var p=_21.parentNode;while(p&&p!=el){if(p.parentNode==el){return p;}p=p.parentNode;}return null;},onClick:function(e){var _25=this.findItemFromChild(e.getTarget());if(_25){var _26=this.indexOf(_25);if(this.onItemClick(_25,_26,e)!==false){this.fireEvent("click",this,_26,_25,e);}}else{this.clearSelections();}},onContextMenu:function(e){var _28=this.findItemFromChild(e.getTarget());if(_28){this.fireEvent("contextmenu",this,this.indexOf(_28),_28,e);}},onDblClick:function(e){var _2a=this.findItemFromChild(e.getTarget());if(_2a){this.fireEvent("dblclick",this,this.indexOf(_2a),_2a,e);}},onItemClick:function(_2b,_2c,e){if(this.fireEvent("beforeclick",this,_2c,_2b,e)===false){return false;}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&e.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),_2c),false);}else{this.select(_2b,this.multiSelect&&e.ctrlKey);this.lastSelection=_2b;}e.preventDefault();}return true;},getSelectionCount:function(){return this.selections.length;},getSelectedNodes:function(){return this.selections;},getSelectedIndexes:function(){var _2e=[],s=this.selections;for(var i=0,len=s.length;i<len;i++){_2e.push(s[i].nodeIndex);}return _2e;},clearSelections:function(_32){if(this.nodes&&(this.multiSelect||this.singleSelect)){this.cmp.elements=this.selections;this.cmp.removeClass(this.selectedClass);this.selections=[];if(!_32){this.fireEvent("selectionchange",this,this.selections);}}},isSelected:function(_33){var s=this.selections;if(s.length<1){return false;}_33=this.getNode(_33);return s.indexOf(_33)!==-1;},select:function(_35,_36,_37){if(_35 instanceof Array){if(!_36){this.clearSelections(true);}for(var i=0,len=_35.length;i<len;i++){this.select(_35[i],true,true);}}else{var _3a=this.getNode(_35);if(_3a&&!this.isSelected(_3a)){if(!_36){this.clearSelections(true);}if(this.fireEvent("beforeselect",this,_3a,this.selections)!==false){Ext.fly(_3a).addClass(this.selectedClass);this.selections.push(_3a);if(!_37){this.fireEvent("selectionchange",this,this.selections);}}}}},getNode:function(_3b){if(typeof _3b=="string"){return document.getElementById(_3b);}else{if(typeof _3b=="number"){return this.nodes[_3b];}}return _3b;},getNodes:function(_3c,end){var ns=this.nodes;_3c=_3c||0;end=typeof end=="undefined"?ns.length-1:end;var _3f=[];if(_3c<=end){for(var i=_3c;i<=end;i++){_3f.push(ns[i]);}}else{for(var i=_3c;i>=end;i--){_3f.push(ns[i]);}}return _3f;},indexOf:function(_41){_41=this.getNode(_41);if(typeof _41.nodeIndex=="number"){return _41.nodeIndex;}var ns=this.nodes;for(var i=0,len=ns.length;i<len;i++){if(ns[i]==_41){return i;}}return -1;}});Ext.JsonView=function(_45,tpl,_47){Ext.JsonView.superclass.constructor.call(this,_45,tpl,_47);var um=this.el.getUpdateManager();um.setRenderer(this);um.on("update",this.onLoad,this);um.on("failure",this.onLoadException,this);this.events["beforerender"]=true;this.events["load"]=true;this.events["loadexception"]=true;};Ext.extend(Ext.JsonView,Ext.View,{jsonRoot:"",refresh:function(){this.clearSelections();this.el.update("");var _49=[];var o=this.jsonData;if(o&&o.length>0){for(var i=0,len=o.length;i<len;i++){var _4d=this.prepareData(o[i],i,o);_49[_49.length]=this.tpl.apply(_4d);}}else{_49.push(this.emptyText);}this.el.update(_49.join(""));this.nodes=this.el.dom.childNodes;this.updateIndexes(0);},load:function(){var um=this.el.getUpdateManager();um.update.apply(um,arguments);},render:function(el,_50){this.clearSelections();this.el.update("");var o;try{o=Ext.util.JSON.decode(_50.responseText);if(this.jsonRoot){o=eval("o."+this.jsonRoot);}}catch(e){}this.jsonData=o;this.beforeRender();this.refresh();},getCount:function(){return this.jsonData?this.jsonData.length:0;},getNodeData:function(_52){if(_52 instanceof Array){var _53=[];for(var i=0,len=_52.length;i<len;i++){_53.push(this.getNodeData(_52[i]));}return _53;}return this.jsonData[this.indexOf(_52)]||null;},beforeRender:function(){this.snapshot=this.jsonData;if(this.sortInfo){this.sort.apply(this,this.sortInfo);}this.fireEvent("beforerender",this,this.jsonData);},onLoad:function(el,o){this.fireEvent("load",this,this.jsonData,o);},onLoadException:function(el,o){this.fireEvent("loadexception",this,o);},filter:function(_5a,_5b){if(this.jsonData){var _5c=[];var ss=this.snapshot;if(typeof _5b=="string"){var _5e=_5b.length;if(_5e==0){this.clearFilter();return;}_5b=_5b.toLowerCase();for(var i=0,len=ss.length;i<len;i++){var o=ss[i];if(o[_5a].substr(0,_5e).toLowerCase()==_5b){_5c.push(o);}}}else{if(_5b.exec){for(var i=0,len=ss.length;i<len;i++){var o=ss[i];if(_5b.test(o[_5a])){_5c.push(o);}}}else{return;}}this.jsonData=_5c;this.refresh();}},filterBy:function(fn,_63){if(this.jsonData){var _64=[];var ss=this.snapshot;for(var i=0,len=ss.length;i<len;i++){var o=ss[i];if(fn.call(_63||this,o)){_64.push(o);}}this.jsonData=_64;this.refresh();}},clearFilter:function(){if(this.snapshot&&this.jsonData!=this.snapshot){this.jsonData=this.snapshot;this.refresh();}},sort:function(_69,dir,_6b){this.sortInfo=Array.prototype.slice.call(arguments,0);if(this.jsonData){var p=_69;var dsc=dir&&dir.toLowerCase()=="desc";var f=function(o1,o2){var v1=_6b?_6b(o1[p]):o1[p];var v2=_6b?_6b(o2[p]):o2[p];if(v1<v2){return dsc?+1:-1;}else{if(v1>v2){return dsc?-1:+1;}else{return 0;}}};this.jsonData.sort(f);this.refresh();if(this.jsonData!=this.snapshot){this.snapshot.sort(f);}}}});
